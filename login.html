<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script async defer src="https://apis.google.com/js/api.js?onload?renderButton" onload="this.onload=function(){};handleClientLoad()" onreadystatechange="if (this.readyState === 'complete') this.onload()">
    </script>
    <meta name="google-signin-scope" content="profile email">
    <meta name="google-signin-client_id" content="904329681840-9r3m3ldik4sik9poh1j6up3gdkrls4q6.apps.googleusercontent.com">
    <title>Login</title>
</head>

<body>
    <div id="my-signin2"></div>
    <script>
        var GoogleAuth;
        //var SCOPE = 'https://www.googleapis.com/auth/blogger.readonly';
        var SCOPE = 'https://www.googleapis.com/auth/blogger';

        function handleClientLoad() {
            // Load the API's client and auth2 modules.
            // Call the initClient function after the modules load.
            gapi.load('client:auth2', initClient);
        }

        function initClient() {
            // Retrieve the discovery document for version 3 of Google Drive API.
            // In practice, your app can retrieve one or more discovery documents.
            var discoveryUrl = 'https://www.googleapis.com/discovery/v1/apis/blogger/v3/rest';
            //https://www.googleapis.com/auth/blogger.readonly

            // Initialize the gapi.client object, which app uses to make API requests.
            // Get API key and client ID from API Console.
            // 'scope' field specifies space-delimited list of access scopes.
            gapi.client.init({
                'redirect_uri': 'http://localhost:5500/Desenvolupament%20Entorn%20Client/Practica1-VanillaJS/posDespues.html',
                'discoveryDocs': [discoveryUrl],
                'clientId': '904329681840-9r3m3ldik4sik9poh1j6up3gdkrls4q6.apps.googleusercontent.com',
                'scope': SCOPE
            }).then(function() {
                GoogleAuth = gapi.auth2.getAuthInstance();


                // Handle initial sign-in state. (Determine if user is already signed in.)
                var user = GoogleAuth.currentUser.get();
                //console.log(user)
                if (user.Zi != null) {
                    console.log("token_access: " + user.Zi.access_token)
                    console.log("id_token: " + user.Zi.id_token)
                    localStorage.setItem("token-acces", user.Zi.access_token);
                }

                // Call handleAuthClick function when user clicks on
                // "Sign In/Authorize" button.
            });
        }

        function redirect() {
            gapi.auth2.SignInOptions()
        }

        function renderButton() {
            gapi.signin2.render('my-signin2', {
                'scope': 'profile email',
                'width': 240,
                'height': 50,
                'longtitle': true,
                'theme': 'dark',
            });
        }

        if (localStorage.getItem("token-acces") != undefined) {
            console.log("Hay token");

            async function request() {
                const response = await fetch("https://www.googleapis.com/blogger/v3/users/self/blogs", {
                    method: 'GET',
                    headers: {
                        'Authorization': localStorage.getItem("token-acces")
                    },
                    contentType: 'application/json'
                });

                console.log(response)
            }

            request();

        } else {
            console.log("No hay token");
        }
    </script>
    <hr>
    <script src="https://apis.google.com/js/platform.js?onload=renderButton" async defer></script>
</body>

</html>