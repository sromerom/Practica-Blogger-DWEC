<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>
    <a href="BLOGGERFORM.html">Crear un post</a>
    <label for="titol">Cerca per un titol de post</label>
    <input id="titol" type="text">
    <div id="taula"></div>
    <script type="module">
        import { getBlogId } from './servici/getBlogId.js';
        import { getPost } from './servici/getPosts.js';
        import { deletePost } from './servici/deletePost.js'
        let postsTotals = [];


        (async function () {
            let blogId = await getBlogId();
            let post = await getPost(blogId);
            postsTotals = post;
            console.log(postsTotals);
            mostraPosts(post);

            let deleteButtons = document.querySelectorAll(".delete");
            deleteButtons.forEach(function (elem) {
                elem.addEventListener("click", async function () {
                    const idBlogActual = elem.attributes[1].nodeValue;
                    const idPostActual = elem.attributes[2].nodeValue;
                    await deletePost(idBlogActual, idPostActual);

                    /*
                    if(confirm("Are you sure to delete this record?")) {
                        console.log("Eliminat")
                    }
                    */
                });
            });

            document.querySelector("#titol").addEventListener("input", function () {
                filtrar();
            })


        })();

        function mostraPosts(posts) {
            let taula = "<table>";
            taula += "<tr>";
            taula += "<th>Titol</th>";
            taula += "<th>Idioma original</th>";
            taula += "<th>Idioma traduit</th>";
            taula += "<th>Edita</th>";
            taula += "<th>Borra</th>"
            taula += "</tr>";
            posts.forEach(post => {
                taula += "<tr>";
                taula += `<th>${post.title}</th>`;
                taula += `<th>Ro4</th>`;
                taula += `<th>Ro4</th>`;
                taula += `<th><a href="BLOGGERFORM.html?idPost=${post.idPost}">Edita</a></th>`;
                //taula += `<th><a href="#" blogId="2" postId="2" class="aaaa">Elimina</a></th>`;
                taula += `<th><button class="delete" blogId="${post.idBlog}" postId="${post.idPost}">Delete</button></th>`;
                taula += "</tr>";
            });
            taula += "</table>";
            document.querySelector("#taula").innerHTML = taula;

            document.querySelector("#titol").disabled = false;
        }

        function filtrar() {
            let valor = document.querySelector('#titol').value;

            let posts = postsTotals.filter(function (post) {
                return post.title.indexOf(valor) != -1
            })

            mostraPosts(posts);

        };
    </script>
</body>

</html>